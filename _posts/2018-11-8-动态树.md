
---
layout: post
title: 2018-11-10 Link-Cut-Tree

date: 2018-11-10
categories: blog
tags: [NOIP,数据结构]
description:  Link-Cut-Tree模板
---

---------------------

NOIP Day1Over 

GG

什么都不想做了

上传一个博客吧

```c++

#include<iostream>
#include<cstdio>
#include<cstdlib>
#include<cstring>
#include<string>
#include<queue>
#include<stack>
#include<algorithm>
#include<vector>
#include<map>
#include<set>
#include<cmath>
#include<sstream>
#include<fstream>
using namespace std;
const int MAXN=2e6+11;
const double pi=acos(-1);
typedef long long ll;
typedef vector<int> vi;
typedef pair<ll,ll> pii;
typedef double dbl;
#define For(a,b,c) for (register int (a)=(b);(a)<(c);(a)++)
#define foreach(iter,V) for (__typeof((V.begin()) iter=(V).begin();iter!=(V).end();iter++)
#define mp make_pair
#define fi first
#define se second
#define pb push_back
int n,m;
struct node{
	int fa = 0,ch[2],w,xorsum;
	bool rev;
}T[MAXN];
#define fa(u) T[u].fa
#define lch(u)	T[u].ch[0]
#define rch(u)	T[u].ch[1]
inline bool isroot(int o){
	return lch(fa(o)) != o && rch(fa(o)) != o;
}
void pushup(int o){
	T[o].xorsum = T[lch(o)].xorsum ^ T[rch(o)].xorsum ^ T[o].w;
}
void pushdown(int o){
	if (T[o].rev){
		T[lch(o)].rev ^= 1;
		T[rch(o)].rev ^= 1;
		T[o].rev ^= 1;
		swap(lch(o),rch(o));
	}
} 
void rotate(int o){
	int f = fa(o),ff = fa(f);
	int l = rch(f) == o;
	int r = l ^ 1;
	if (!isroot(f))	T[ff].ch[rch(ff) == f] = o;
	fa(o) = ff;
	T[f].ch[l] = T[o].ch[r];
	fa(T[o].ch[r]) = f;
	T[o].ch[r] = f;
	fa(f) = o;
	pushup(f);
	pushup(o);
	pushup(ff);
}
int sta[MAXN],top;
inline void splay(int o){
	top = 0;
	sta[++top] = o;
	for (int i = o;!isroot(i);i = fa(i))	sta[++top] = fa(i);
	for (int i = top;i >= 1;i--)	pushdown(sta[i]);
	while(!isroot(o)){
		int f = fa(o),ff = fa(f);
		if (!isroot(f)){
			if ((rch(ff) == f) != (rch(f) == o))	rotate(o);
			else rotate(f);
		}
		rotate(o);
	}
	pushup(o);
}
inline void access(int o){
	int t = 0;
	while(o){
		splay(o);
		rch(o) = t;
		pushup(o);
		t = o;
		o = fa(o);
	}
}
void make_root(int o){
	access(o);
	splay(o);
	T[o].rev ^= 1;
}
int find_root(int o){
	access(o);splay(o);
	int lch = o;
	while(lch(lch))	{
		pushdown(lch);
		lch = lch(lch);
	}
	return lch;
}
void link(int x,int y){
	make_root(x);
	if (find_root(y) != x)	fa(x) = y;
	pushup(y);
	splay(x);
}
void cut(int x,int y){
	make_root(x);
	access(y);
	splay(y);
	if (lch(y) == x){
		lch(y) = fa(x) = 0;
		pushup(y);
	}
}
inline void make_path(int u,int v){
	make_root(u);
	access(v);
	splay(v); 
}
int main(){
	//freopen("in.txt","r",stdin);
	scanf("%d%d",&n,&m);
	For(i,1,n + 1)	scanf("%d",&T[i].w);
	int opt,u,v;
	For(i,0,m){
		scanf("%d%d%d",&opt,&u,&v);
		switch(opt){
			case 0: make_path(u,v);printf("%d\n",T[v].xorsum);break;
			case 1: link(u,v);break;
			case 2: cut(u,v);break;
			case 3: splay(u);T[u].w = v;
		}
	}
	return 0;
}

```
