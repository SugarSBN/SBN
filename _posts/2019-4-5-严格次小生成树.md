---
layout: post
title: 2019-4-5 严格次小生成树

date: 2019-4-5
categories: blog
tags: [,]
description: 
---

---------------------

```c++
void dfs(ll u,ll fa){
	For(i,1,20){
		grand[u][i] = grand[grand[u][i - 1]][i - 1];
		grandw[u][i] = max(grandw[grand[u][i - 1]][i - 1],grandw[u][i - 1]);
		if (grandw[u][i - 1] < grandw[u][i])	grandww[u][i] = max(grandww[u][i],grandw[u][i - 1]);
		else	grandww[u][i] = max(grandww[u][i],grandww[u][i - 1]);
		if (grandw[grand[u][i - 1]][i - 1] < grandw[u][i])	grandww[u][i] = max(grandww[u][i],grandw[grand[u][i - 1]][i - 1]);
		else	grandww[u][i] = max(grandww[u][i],grandww[grand[u][i - 1]][i - 1]);
	}	
	for (ll i = head[u];i;i = E[i].nxt)	if (E[i].y != fa){
		grand[E[i].y][0] = u;
		grandw[E[i].y][0] = E[i].len;
		grandww[E[i].y][0] = -1;
		dep[E[i].y] = dep[u] + 1;
		dfs(E[i].y,u);
	}
}
pii dis(ll u,ll v){
	if (u == v)	return mp(0,-1);
	if (dep[u] < dep[v])	swap(u,v);
	ll res = -1,res1 = -1;
	for (ll i = 20;i >= 0;i--)	if (dep[grand[u][i]] >= dep[v]){
		if (grandw[u][i] >= res){
			res1 = max(res == grandw[u][i] ? res1 : res,grandww[u][i]);res = grandw[u][i];
		}	else res1 = max(res1,grandw[u][i]);
		u = grand[u][i];
	}
	if (u == v)	return mp(res,res1);
	for (ll i = 20;i >= 0;i--)	if (grand[u][i] != grand[v][i]){
		if (grandw[u][i] >= res){
			res1 = max(res == grandw[u][i] ? res1 : res,grandww[u][i]);res = grandw[u][i];
		}else	res1 = max(res1,grandw[u][i]);
		if (grandw[v][i] >= res){
			res1 = max(res == grandw[v][i] ? res1 : res,grandww[v][i]);res = grandw[v][i];
		}else	res1 = max(res1,grandw[v][i]);
		u = grand[u][i];
		v = grand[v][i];
	}
	if (grandw[u][0] >= res){
		res1 = max(res == grandw[u][0] ? res1 : res,grandww[u][0]);
		res = grandw[u][0];
	}else	res1 = max(res1,grandw[u][0]);
	if (grandw[v][0] >= res){
		res1 = max(res == grandw[v][0] ? res1 : res,grandww[v][0]);
		res = grandw[v][0];
	}else	res1 = max(res1,grandw[v][0]);
	return mp(res,res1);
}
bool vis[MAXN];
ll ans1;
void kruskal(){
	For(i,1,n + 1)	fa[i] = i;
	sort(e,e + m);
	ans = 0;
	For(i,0,m){
		ll fx = getfa(e[i].se.fi),fy = getfa(e[i].se.se);
		if (fx == fy)	continue;
		link(e[i].se.fi,e[i].se.se,e[i].fi);
		ans += e[i].fi;
		vis[i] = 1;
		fa[fx] = fy;
	}
	memset(grandww,-1,sizeof(grandww));
	memset(grandw,-1,sizeof(grandw));
	dep[1] = 1;dep[0] = 0;
	dfs(1,0);
	ans1 = INF;
	For(i,0,m)	if (!vis[i]){
		pii d = dis(e[i].se.fi,e[i].se.se);
	//	printf("(%d,%d)=%d,%d\n",e[i].se.fi,e[i].se.se,d.fi,d.se);
		if (d.se == -1 && d.fi == e[i].fi)	continue;
		if (d.fi == e[i].fi)	ans1 = min(ans1,ans - d.se + e[i].fi);
		else	ans1 = min(ans1,ans - d.fi + e[i].fi);
	}
}
```