---
layout: post
title: 2019-4-5 LCT

date: 2019-4-5
categories: blog
tags: [,]
description: 
---

---------------------

```c++
bool is_root(int o){return !(lch(fa(o)) == o || rch(fa(o)) == o);}
inline void pushdown(int o){
	if (T[o].rev){
		T[lch(o)].rev ^= 1;
		T[rch(o)].rev ^= 1;
		T[o].rev = 0;
		swap(lch(lch(o)),rch(lch(o)));
		swap(lch(rch(o)),rch(rch(o)));
	}	
}
inline void pushup(int o){
	T[o].xorsum = T[lch(o)].xorsum ^ T[rch(o)].xorsum ^ T[o].val;
}
inline void rotate(int o){
	int f = fa(o),g = fa(f);
	int d1 = rch(f) == o,d2 = rch(g) == f;
	if (!is_root(f))	T[g].ch[d2] = o;fa(o) = g;
	T[f].ch[d1] = T[o].ch[d1 ^ 1];fa(T[o].ch[d1 ^ 1]) = f;
	T[o].ch[d1 ^ 1] = f;fa(f) = o;
	pushup(f);pushup(o);
	pushup(g);
}
int sta[MAXN],top;
inline void splay(int o){
	top = 0;
	int u = o;
	while(!is_root(u)){
		sta[++top] = u;
		u = fa(u);
	}
	pushdown(u);
	for (int i = top;i >= 1;i--)	pushdown(sta[i]);
	while(!is_root(o)){
		int f = fa(o),g = fa(f);
		if (!is_root(f)){
			if ((rch(f) == o) == (rch(g) == f))	rotate(f);
			else rotate(o);
		}
		rotate(o); 
	}
}
inline void access(int o){
	for (int u = o,v = 0;u;v = u,u = fa(u)){
		splay(u);rch(u) = v;pushup(u);
	}
}
inline void make_root(int o){
	access(o);
	splay(o);
	T[o].rev ^= 1;
	swap(lch(o),rch(o));
}
inline int find_root(int o){
	access(o);splay(o);
	int res = o;
	while(lch(res)){
		pushdown(res);
		res = lch(res);
	}
	return res;
}
inline void link(int u,int v){
	if (find_root(u) == find_root(v))	return;
	make_root(u);fa(u) = v;
}
inline void split(int u,int v){
	make_root(u);
	access(v);
	splay(v);
}
inline void cut(int u,int v){
	split(u,v);
	if (lch(v) == u){
		fa(u) = lch(v) = 0;
		pushup(v);
	}
} 
```