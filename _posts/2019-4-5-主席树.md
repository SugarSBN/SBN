---
layout: post
title: 2019-4-5 主席树

date: 2019-4-5
categories: blog
tags: [,]
description: 
---

---------------------

```c++
#define lch(o)	T[o].ch[0]
#define rch(o)	T[o].ch[1] 
void build(int o,int l,int r){
	T[o].l = l;T[o].r = r;T[o].siz = 0;
	if (l == r)	return;
	lch(o) = ++siz;rch(o) = ++siz;
	build(lch(o),l,(l + r) >> 1);
	build(rch(o),((l + r) >> 1) + 1,r);
} 
void insert(int o0,int o1,int num){
	if (T[o1].l == T[o1].r){
		T[o1].siz++;
		return;
	}
	int mid = (T[o0].l + T[o0].r) >> 1;
	if (num <= mid){
		rch(o1) = rch(o0);
		lch(o1) = ++siz;
		T[lch(o1)] = T[lch(o0)];
		insert(lch(o0),lch(o1),num);
	}else{
		lch(o1) = lch(o0);
		rch(o1) = ++siz;
		T[rch(o1)] = T[rch(o0)];
		insert(rch(o0),rch(o1),num); 
	}
	T[o1].siz = T[lch(o1)].siz + T[rch(o1)].siz;
}
int k_th(int o0,int o1,int k){
	if (T[o0].l == T[o0].r)	return T[o0].l;
	int d = T[lch(o1)].siz - T[lch(o0)].siz;
	if (d >= k)	return k_th(lch(o0),lch(o1),k);
	return k_th(rch(o0),rch(o1),k - d);
}
```