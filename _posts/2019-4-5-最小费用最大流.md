---
layout: post
title: 2019-4-5 最小费用最大流

date: 2019-4-5
categories: blog
tags: [,]
description: 
---

---------------------

```c++
pii MFMC(){
	int max_flow = 0,min_cost = 0;
	memset(h,0,sizeof(h));
	while(1){
		memset(dis,0x3f,sizeof(dis));
		dis[s] = 0;
		queue<int> Q;Q.push(s);
		while(!Q.empty()){
			int u = Q.front();Q.pop();
			vis[u] = 0;
			for (int i = head[u];i;i = E[i].nxt)	if (E[i].flow && dis[E[i].y] > dis[u] + E[i].cost + h[u] - h[E[i].y]){
				dis[E[i].y] = dis[u] + E[i].cost + h[u] - h[E[i].y];
				preve[E[i].y] = i;
				prevv[E[i].y] = u;
				if (!vis[E[i].y]){
					vis[E[i].y] = 1;
					Q.push(E[i].y);
				}
			}
		}
		if (dis[t] == INF)	return mp(max_flow,min_cost);
		For(i,1,n + 1)	h[i] += dis[i];
		int d = INF;
		for (int i = t;i != s;i = prevv[i])	d = min(d,E[preve[i]].flow);
		max_flow += d;
		min_cost += d * h[t];
		for (int i = t;i != s;i = prevv[i]){
			E[preve[i]].flow -= d;
			E[preve[i] ^ 1].flow += d;
		}
	}
}
```