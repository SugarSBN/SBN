---
layout: post
title: 2019-4-5 点分治

date: 2019-4-5
categories: blog
tags: [,]
description: 
---

---------------------

```c++
void Gpoint(int u,int fa){
	int mxsiz = 0;
	siz[u] = 1;
	For(i,0,G[u].size()){
		int v = G[u][i].se;
		if (vis[v] || v == fa)	continue;
		Gpoint(v,u);
		siz[u] += siz[v];
		if (siz[v] > mxsiz)	mxsiz = siz[v];
	}
	if (totsiz - siz[u] > mxsiz)	mxsiz = totsiz - siz[u];
	if (mxsiz < maxsiz){
		maxsiz = mxsiz;
		Gp = u;
	}
}
pii dis[MAXN];
int pdis;
void dfs(int u,int fa,int top){
	siz[u] = 1;
	int dis0 = dis[pdis].se;
	For(i,0,G[u].size()){
		int v = G[u][i].se;
		if (vis[v] || v == fa)	continue;
		dis[++pdis] = mp(top,dis0 + G[u][i].fi);
		dfs(v,u,top);
		siz[u] += siz[v];
	}
}
set<int> S;
bool DFZ(int u,int k){
	maxsiz = INF;
	Gpoint(u,-1);
	u = Gp;
	vis[u] = 1;
	For(i,1,n + 1)	dis[i] = mp(0,0);
	dis[pdis = 1] = mp(0,0);
	For(i,0,G[u].size()){
		int v = G[u][i].se;
		if (vis[v])	continue;
		dis[++pdis] = mp(v,G[u][i].fi);
		dfs(v,u,v);
	}
	S.clear();
	sort(dis + 1,dis + pdis + 1);
	for (int i = 1;i <= pdis;){
		int j = i + 1;
		while(dis[j].fi == dis[i].fi && j <= pdis)	j++;
		For(p,i,j)	if (S.count(k - dis[p].se))		return 1;
		For(p,i,j)	S.insert(dis[p].se);
		i = j;	
	}
	For(i,0,G[u].size()){
		int v = G[u][i].se;
		if (!vis[v]){
			totsiz = siz[v];
			if(DFZ(v,k))return 1;
		}
	}
	return 0;
}
```